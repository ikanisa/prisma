# Endpoints and Workflows

## Table of Contents
- [Web Endpoints](#web-endpoints)

## Web Endpoints
| Method | Path | Auth | Description | Input Schema | Output Schema | Rate Limit | Idempotency |
|---|---|---|---|---|---|---|---|
| POST | `/functions/v1/seed-data` | Supabase service key | Seeds initial org/users/clients/tasks | n/a | JSON `{success, message}` | none | none |
| GET | `/functions/v1/audit-kam/list` | Supabase JWT | Lists KAM candidates, drafts, approvals (auto-seeds sources) | Query: `orgSlug`, `engagementId`, `seed?` | `{ candidates[], drafts[], approvals[], role }` | 60/min per user | auto |
| POST | `/functions/v1/audit-kam/candidate/add` | Supabase JWT | Adds a KAM candidate (manual or linked to risk/estimate/GC) | `{ orgSlug, engagementId, title, rationale?, source, riskId?, estimateId?, goingConcernId? }` | `{ candidate }` | 30/min per user | n/a |
| POST | `/functions/v1/audit-kam/candidate/select` | Supabase JWT | Marks candidate as selected for drafting | `{ orgSlug, engagementId, candidateId, reason? }` | `{ candidate }` | 30/min per user | n/a |
| POST | `/functions/v1/audit-kam/candidate/exclude` | Supabase JWT | Marks candidate as excluded | `{ orgSlug, engagementId, candidateId, reason? }` | `{ candidate }` | 30/min per user | n/a |
| POST | `/functions/v1/audit-kam/draft/create` | Supabase JWT | Creates draft scaffold from selected candidate | `{ orgSlug, engagementId, candidateId, heading?, whyKam? }` | `{ draft }` | 20/min per user | n/a |
| POST | `/functions/v1/audit-kam/draft/update` | Supabase JWT | Updates draft narrative and references | `{ orgSlug, engagementId, draftId, heading?, whyKam?, howAddressed?, resultsSummary?, proceduresRefs?, evidenceRefs? }` | `{ draft }` | 60/min per user | n/a |
| POST | `/functions/v1/audit-kam/draft/submit` | Supabase JWT | Submits draft for approvals (queues manager/partner/EQR) | `{ orgSlug, engagementId, draftId }` | `{ draft }` | 10/min per user | n/a |
| GET | `/functions/v1/audit-kam/export` | Supabase JWT | Exports approved KAM drafts (`format=json|markdown`) | Query: `orgSlug`, `engagementId`, `format?` | `{ drafts[], count }` or `{ markdown, count }` | 20/min per user | auto |
| POST | `/functions/v1/audit-kam/approval/decide` | Supabase JWT | Records manager/partner/EQR approval or rejection | `{ orgSlug, engagementId, approvalId, decision, note? }` | `{ approvals[] }` | 30/min per user | n/a |
| POST | `/functions/v1/audit-report/draft/create` | Supabase JWT | Creates audit report draft seeded with approved KAMs & GC flag | `{ orgSlug, engagementId }` | `{ report }` | 20/min per user | n/a |
| POST | `/functions/v1/audit-report/draft/update` | Supabase JWT | Updates report narrative and section toggles | `{ orgSlug, engagementId, reportId, ... }` | `{ report }` | 60/min per user | n/a |
| POST | `/functions/v1/audit-report/decision-tree` | Supabase JWT | Computes recommended opinion & required sections | `{ orgSlug, engagementId }` | `{ recommendedOpinion, reasons[], requiredSections[] }` | 20/min per user | auto |
| POST | `/functions/v1/audit-report/submit` | Supabase JWT | Submits report draft for approval queue | `{ orgSlug, engagementId, reportId }` | `{ report }` | 10/min per user | n/a |
| POST | `/functions/v1/audit-report/release` | Supabase JWT | Marks report as released after approvals | `{ orgSlug, engagementId, reportId }` | `{ report }` | 5/min per user | n/a |
| GET | `/functions/v1/audit-report/get` | Supabase JWT | Retrieves latest report draft and approvals | Query: `orgSlug`, `engagementId` | `{ report, approvals[] }` | 60/min per user | auto |
| POST | `/functions/v1/audit-report/export/pdf` | Supabase JWT | Renders current draft to PDF, stores in documents bucket | `{ orgSlug, engagementId, reportId }` | `{ documentId, path }` | 10/min per user | n/a |
| POST | `/functions/v1/audit-acceptance/background/run` | Supabase JWT | Save client background screening metadata | `{ orgSlug, clientId, screenings, riskRating, notes? }` | `{ backgroundCheckId }` | 30/min per user | n/a |
| POST | `/functions/v1/audit-acceptance/independence/assess` | Supabase JWT | Record independence threats & safeguards | `{ orgSlug, clientId, threats[], safeguards[], conclusion }` | `{ assessmentId }` | 30/min per user | n/a |
| POST | `/functions/v1/audit-acceptance/decision/submit` | Supabase JWT | Submit acceptance decision/EQR flag for Partner approval | `{ orgSlug, engagementId, decision, eqrRequired, rationale? }` | `{ decisionId, status }` | 10/min per user | n/a |
| POST | `/functions/v1/audit-acceptance/decision/decide` | Supabase JWT | Partner approval or rejection of acceptance | `{ orgSlug, engagementId, approvalId, decision, note? }` | `{ decision }` | 10/min per user | n/a |
| GET | `/functions/v1/audit-acceptance/status` | Supabase JWT | Returns acceptance snapshot (decision, background, independence, approvals) | Query: `orgSlug`, `engagementId` | `{ status, background, independence, approvals[] }` | 60/min per user | auto |
| POST | `/api/agent/start` | Supabase JWT | Creates agent session, seeds planner run, and (when enabled) provisions OpenAI thread metadata | `{ orgSlug, engagementId?, agentType }` | `{ sessionId }` | 20/min per user | in-memory cache (5 min) |
| POST | `/api/agent/plan` | Supabase JWT | Generates agent plan document via OpenAI Responses with fallback persona | `{ sessionId, request? }` | `{ plan, personaVersion, policyPackVersion, model, usage?, costUsd?, isFallback }` | 20/min per user | in-memory cache (5 min per session) |
| POST | `/api/agent/respond` | Supabase JWT | Creates a single model response using OpenAI Responses (non-streaming) | `{ orgSlug, request?, input?, model? }` | `{ response }` | 20/min per user | n/a |
| POST | `/api/agent/execute` | Supabase JWT | Executes plan step tools, recording agent actions and queuing approvals for sensitive tools | `{ sessionId, stepIndex }` | `{ stepIndex, results[], state }` | 20/min per user | n/a |
| POST | `/api/agent/approve` | Supabase JWT (manager+) | Records approval decision for blocked agent tool and resumes execution when approved | `{ approvalId, decision, comment? }` | `{ approval }` | 20/min per user | n/a |
| GET | `/api/agent/telemetry` | Supabase JWT | Aggregates session counts, pending approvals, and recent error traces for HITL dashboards | Query: `orgSlug` | `{ sessionsByStatus, sessionsTrend[], pendingCount, averagePendingHours, topErrorTools[], recentTraces[] }` | 30/min per user | auto |
| GET | `/api/agent/stream` | Supabase JWT | Streams agent responses over SSE when `OPENAI_STREAMING_ENABLED=true` | Query: `orgSlug`, `question`, `agentType?`, `context?` | SSE events (`text-delta`, `text-done`, `completed`, `[DONE]`) | 10/min per user | n/a |
| GET | `/api/agent/stream/execute` | Supabase JWT | Streams tool-aware agent responses (tool-start/result + final text) | Query: `orgSlug`, `question`, `agentType?`, `context?` | SSE events (`tool-start`, `tool-result`, `text-final`, `usage`, `[DONE]`) | 10/min per user | n/a |
| POST | `/api/agent/realtime/session` | Supabase JWT | Issues OpenAI Realtime ephemeral client secret, stores metadata in `chatkit_sessions` | `{ orgSlug, agentSessionId, voice? }` | `{ clientSecret, sessionId, expiresAt, turnServers[] }` | 10/min per user | n/a |
| POST | `/api/agent/chatkit/session` | Supabase JWT | Upserts ChatKit session linkage for an agent session | `{ agentSessionId, chatkitSessionId, metadata? }` | `{ session }` | 30/min per user | n/a |
| POST | `/api/agent/chatkit/session/:id/cancel` | Supabase JWT | Marks ChatKit session as cancelled | Path param `id` (chatkit session id) | `{ session }` | 30/min per user | n/a |
| POST | `/api/agent/chatkit/session/:id/resume` | Supabase JWT | Resumes a stored ChatKit session, updating metadata | Path param `id`, optional body metadata | `{ session }` | 30/min per user | n/a |
| POST | `/api/agent/chatkit/session/:id/transcribe` | Supabase JWT | Runs Whisper transcription on uploaded audio and records transcript | `{ audio (base64), mimeType?, language?, model?, metadata? }` | `{ transcript, model, language, duration, usage? }` | 20/min per user | n/a |
| POST | `/api/agent/chatkit/session/:id/tts` | Supabase JWT | Generates speech audio from agent text and records transcript metadata | `{ text, voice?, model?, format?, metadata? }` | `{ audio (base64), format, model, voice }` | 20/min per user | n/a |
| GET | `/api/agent/chatkit/session/:id/transcripts` | Supabase JWT | Returns stored ChatKit transcripts for the session | Query: `limit?` | `{ transcripts[] }` | 60/min per user | n/a |
| POST | `/api/agent/media/video` | Supabase JWT | Enqueues Sora video generation job (feature-flag `OPENAI_SORA_ENABLED`) | `{ orgSlug, prompt, aspectRatio? }` | `HTTP 202` `{ job }` | 5/min per user | n/a |
| POST | `/api/agent/orchestrator/session` | Supabase JWT | Creates orchestration session board (Director + Safety manifests) | `{ orgSlug, objective, engagementId?, tasks?, metadata?, directorAgentKey?, safetyAgentKey? }` | `{ session, tasks }` | 10/min per user | n/a |
| GET | `/api/agent/orchestrator/session/:id` | Supabase JWT | Returns orchestration board (session state + tasks) | Path param `id` | `{ session, tasks }` | 30/min per user | auto |
| POST | `/api/agent/orchestrator/tasks/:id/complete` | Supabase JWT | Updates task status/output and optionally logs safety events | `{ status, output?, metadata?, safetyEvent? }` | `{ session, tasks, task, status }` | 30/min per user | n/a |
| GET | `/api/agent/orchestrator/agents` | Supabase JWT | Lists available domain agents and descriptive metadata | n/a | `{ agents[] }` | 60/min per user | auto |
| POST | `/api/agent/orchestrator/plan` | Supabase JWT | Generates multi-agent orchestration plan for supplied objective | `{ orgSlug, objective, priority?, constraints? }` | `{ plan }` | 20/min per user | n/a |
| GET | `/api/agent/approvals` | Next.js session cookie | Returns pending/history approval queue entries for HITL UI | Query: `orgId` | `{ pending[], history[] }` | 30/min per user | auto |
| PATCH | `/api/agent/tool-registry` | Next.js session cookie | Updates tool flags (enabled, role, sensitivity, standards mapping) | `{ id, enabled?, minRole?, sensitive?, standardsRefs?, updatedByUserId? }` | `{ success: true }` | 30/min per user | n/a |
| POST | `/api/agent/approvals/:id/decision` | Next.js session cookie | Proxies approval decision to RAG service, forwarding auth headers | `{ decision, comment?, orgSlug?, evidence? }` | Upstream response passthrough | 30/min per user | n/a |
| GET | `/v1/approvals` | Supabase JWT | Lists pending/history approvals (manager+) | Query: `orgSlug` | `{ pending[], history[] }` | 60/min per user | n/a |
| POST | `/v1/approvals/:id/decision` | Supabase JWT | Records approval decision with optional evidence | `{ decision, comment?, evidence?, orgSlug }` | `{ approval }` | 30/min per user | `approvalId` |
| GET | `/functions/v1/audit-pbc/list` | Supabase JWT | List PBC requests with deliveries for an engagement | Query: `orgSlug`, `engagementId` | `{ requests[] }` | 60/min per user | auto |
| POST | `/functions/v1/audit-pbc/template/instantiate` | Supabase JWT | Create PBC requests for a cycle from template items | `{ orgSlug, engagementId, cycle, items[] }` | `{ requests[] }` | 20/min per user | n/a |
| POST | `/functions/v1/audit-pbc/request/update-status` | Supabase JWT | Update request status, attach delivery, auto-ingest to evidence | `{ orgSlug, requestId, status, documentId?, note?, procedureId? }` | `{ requests[] }` | 30/min per user | n/a |
| POST | `/functions/v1/audit-pbc/request/remind` | Supabase JWT | Queue reminder notification for client PBC item | `{ orgSlug, requestId, message? }` | `{ success }` | 20/min per user | n/a |
| GET | `/api/recon` | Supabase JWT | List reconciliations and items for a period | Query: `orgId`, `entityId?`, `periodId?` | `{ reconciliations[] }` | 60/min per org | n/a |
| POST | `/api/recon/create` | Supabase JWT | Create reconciliation for control area | `{ orgId, engagementId?, entityId, periodId, type, controlAccountId?, externalBalance, preparedByUserId }` | `{ reconciliation }` | 30/min per org | n/a |
| POST | `/api/recon/add-item` | Supabase JWT | Add reconciling item | `{ orgId, reconciliationId, item { category, amount, reference?, note?, resolved? } }` | `{ inserted: 1 }` | 60/min per org | n/a |
| POST | `/api/recon/close` | Supabase JWT | Close reconciliation when difference cleared | `{ orgId, reconciliationId, userId, scheduleDocumentId? }` | `{ status: 'CLOSED' }` | 30/min per org | n/a |
| GET | `/api/group` | Supabase JWT | List group components with instructions/workpapers/reviews | Query: `orgId`, `engagementId` | `{ components[] }` | 60/min per org | n/a |
| POST | `/api/group/component` | Supabase JWT | Create group component | `{ orgId, engagementId, name, country?, significance?, materiality?, assignedFirm?, notes?, userId }` | `{ component }` | 30/min per org | n/a |
| POST | `/api/group/instruction` | Supabase JWT | Record component instruction | `{ orgId, engagementId, componentId, title, status?, dueAt?, userId }` | `{ instruction }` | 60/min per org | n/a |
| POST | `/api/group/review` | Supabase JWT | Update component review status | `{ orgId, engagementId, componentId, reviewerUserId, status?, notes?, userId }` | `{ success, reviewId }` | 60/min per org | n/a |
| POST | `/api/group/workpaper` | Supabase JWT | Register component workpaper document | `{ orgId, engagementId, componentId, instructionId?, documentBucket, documentPath, documentName, note?, userId }` | `{ workpaper, signedUrl }` | 30/min per org | n/a |
| GET | `/api/soc/service-orgs` | Supabase JWT | List service organisations, reports, and CUECs | Query: `orgId`, `engagementId` | `{ serviceOrgs[] }` | 60/min per org | n/a |
| POST | `/api/soc/service-orgs` | Supabase JWT | Create service organisation record | `{ orgId, engagementId, name, description?, serviceType?, relianceAssessed?, residualRisk?, userId }` | `{ serviceOrg }` | 30/min per org | n/a |
| POST | `/api/soc/report` | Supabase JWT | Attach SOC report metadata | `{ orgId, engagementId, serviceOrgId, reportType?, scope?, periodStart?, periodEnd?, issuedAt?, auditor?, notes?, userId }` | `{ report }` | 30/min per org | n/a |
| POST | `/api/soc/cuec` | Supabase JWT | Record/assess complementary user entity control | `{ orgId, engagementId, serviceOrgId, description, status?, tested?, exceptionNote?, compensatingControl?, userId }` | `{ cuec }` | 60/min per org | n/a |
| GET | `/api/exp/assessments` | Supabase JWT | List specialist reliance assessments | Query: `orgId`, `engagementId` | `{ assessments[] }` | 60/min per org | n/a |
| POST | `/api/exp/assessments` | Supabase JWT | Create or update specialist assessment | `{ orgId, engagementId, specialistKind, name, firm?, scope?, competenceRationale?, objectivityRationale?, workPerformed?, conclusion?, conclusionNotes?, memoDocumentId?, userId }` | `{ assessment }` | 30/min per org | n/a |
| POST | `/api/exp/assessments/conclude` | Supabase JWT | Finalise conclusion and queue approval | `{ orgId, engagementId, assessmentId, conclusion, conclusionNotes?, memoDocumentId?, userId }` | `{ assessment }` | 30/min per org | n/a |
| GET | `/functions/v1/audit-plan/status` | Supabase JWT | Retrieves audit plan snapshot (strategy, materiality, history, approvals) | Query: `orgSlug`, `engagementId` | `{ plan, materiality, changeLog[], approvals[] }` | 60/min per user | auto |
| POST | `/functions/v1/audit-plan/strategy/upsert` | Supabase JWT | Upserts overall audit strategy metadata | `{ orgSlug, engagementId, basisFramework, strategy }` | `{ planId }` | 30/min per user | n/a |
| POST | `/functions/v1/audit-plan/materiality/set` | Supabase JWT | Records materiality set (FS, performance, CTT, rationale) | `{ orgSlug, engagementId, fsMateriality, performanceMateriality, clearlyTrivialThreshold, benchmarks?, rationale? }` | `{ materialityId }` | 30/min per user | n/a |
| POST | `/functions/v1/audit-plan/plan/submit` | Supabase JWT | Submits audit plan for partner approval and queues workflow | `{ orgSlug, engagementId }` | `{ approvalId }` | 10/min per user | n/a |
| POST | `/functions/v1/audit-plan/plan/approve` | Supabase JWT | Partner approval (or rejection) and plan lock | `{ orgSlug, engagementId, approvalId, decision, note? }` | `{ status }` | 10/min per user | n/a |
| GET | `/functions/v1/audit-risk` | Supabase JWT | Lists risks, analytics signals, and activity for engagement | Query: `orgSlug`, `engagementId` | `{ risks[], signals[], activity[] }` | 60/min per user | auto |
| POST | `/functions/v1/audit-risk/risk/upsert` | Supabase JWT | Creates or updates a risk register entry (ISA 315R) | `{ orgSlug, engagementId, id?, code?, title, description?, category, assertions[], likelihood, impact, inherentRating, residualRating?, status?, ownerUserId?, analyticsSummary? }` | `{ id }` | 60/min per user | n/a |
| POST | `/functions/v1/audit-risk/risk/status` | Supabase JWT | Updates risk status/residual rating and logs activity | `{ orgSlug, engagementId, id, status, residualRating?, note? }` | `{ status }` | 30/min per user | n/a |
| POST | `/functions/v1/audit-risk/signal/record` | Supabase JWT | Records analytics signal tied to a risk (severity, metrics) | `{ orgSlug, engagementId, riskId?, signalType?, source?, severity?, metric?, detectedAt? }` | `{ id }` | 60/min per user | n/a |
| POST | `/functions/v1/audit-risk/activity/add` | Supabase JWT | Appends reviewer/partner note to risk history | `{ orgSlug, engagementId, riskId, action?, notes?, metadata? }` | `{ id }` | 60/min per user | n/a |
| GET | `/functions/v1/audit-responses` | Supabase JWT | Lists planned responses and completeness checks for engagement | Query: `orgSlug`, `engagementId` | `{ responses[], checks[] }` | 60/min per user | auto |
| POST | `/functions/v1/audit-responses/response/upsert` | Supabase JWT | Creates or updates planned response linked to risk (ISA 330) | `{ orgSlug, engagementId, id?, riskId, responseType, title, objective?, procedure?, linkage?, ownership?, coverageAssertions?, plannedEffectiveness?, status? }` | `{ id }` | 60/min per user | n/a |
| POST | `/functions/v1/audit-responses/response/status` | Supabase JWT | Updates status of a planned response | `{ orgSlug, engagementId, id, status }` | `{ status }` | 60/min per user | n/a |
| POST | `/functions/v1/audit-responses/response/check` | Supabase JWT | Records manager completeness check for responses | `{ orgSlug, engagementId, responseId, completeness, conclusions?, metadata? }` | `{ id }` | 30/min per user | n/a |
| GET | `/functions/v1/audit-fraud` | Supabase JWT | Retrieves fraud plan, actions, and JE strategy | Query: `orgSlug`, `engagementId` | `{ plan, actions[], journalEntryStrategy }` | 60/min per user | auto |
| POST | `/functions/v1/audit-fraud/fraud-plan/upsert` | Supabase JWT | Saves fraud brainstorming, risks, responses, analytics plan | `{ orgSlug, engagementId, brainstormingNotes?, inherentFraudRisks?, fraudResponses?, analyticsStrategy?, overrideAssessment? }` | `{ id }` | 60/min per user | n/a |
| POST | `/functions/v1/audit-fraud/fraud-plan/submit` | Supabase JWT | Submits fraud plan for partner approval | `{ orgSlug, engagementId }` | `{ approvalId }` | 20/min per user | n/a |
| POST | `/functions/v1/audit-fraud/fraud-plan/approve` | Supabase JWT | Partner approval or rejection of fraud plan | `{ orgSlug, engagementId, approvalId, decision?, note? }` | `{ status }` | 20/min per user | n/a |
| POST | `/functions/v1/audit-fraud/fraud-plan/action` | Supabase JWT | Adds note/action entry to fraud plan log | `{ orgSlug, engagementId, action?, notes?, metadata? }` | `{ id }` | 60/min per user | n/a |
| POST | `/functions/v1/audit-fraud/je-strategy/upsert` | Supabase JWT | Upserts journal-entry testing scope/filters | `{ orgSlug, engagementId, scope?, filters?, thresholds?, schedule?, analyticsLink?, ownerUserId? }` | `{ id }` | 60/min per user | n/a |
| POST | `/functions/v1/tax-mt-cit/compute` | Supabase JWT | Malta CIT computation with full imputation/refund logic | `{ orgSlug, taxEntityId, period, preTaxProfit, adjustments[], participationExempt, refundProfile, notes? }` | `{ computationId, chargeableIncome, citAmount, refundAmount }` | 30/min per user | n/a |
| POST | `/functions/v1/tax-mt-cit/prepare-return` | Supabase JWT | Generates return schedules and stores payload metadata | `{ orgSlug, taxEntityId, period }` | `{ returnFile }` | 20/min per user | n/a |
| POST | `/functions/v1/tax-mt-cit/submit` | Supabase JWT | Submits CIT computation for partner approval queue | `{ orgSlug, taxEntityId, period, engagementId? }` | `{ approvalId }` | 10/min per user | n/a |
| POST | `/functions/v1/tax-mt-cit/approve` | Supabase JWT | Partner decision on CIT computation (locks records) | `{ orgSlug, taxEntityId, period, approvalId, decision?, note? }` | `{ status }` | 10/min per user | n/a |
| POST | `/functions/v1/tax-mt-nid` (`calculator=PILLAR_TWO`) | Supabase JWT | Computes Pillar Two QDMTT/IIR, stores jurisdiction results & GIR snapshot | `{ orgSlug, rootTaxEntityId, period, jurisdictions[], minimumRate?, notes?, metadata? }` | `{ computation, summary }` | 20/min per user | n/a |
| GET | `/functions/v1/tax-mt-nid` (`calculator=PILLAR_TWO`) | Supabase JWT | Lists Pillar Two computations filtered by root entity or period | Query: `orgSlug`, `taxEntityId?`, `period?` | `{ data[] }` | 60/min per user | auto |
| POST | `/functions/v1/tax-mt-nid` (`calculator=TREATY_WHT`, `action=COMPUTE`) | Supabase JWT | Computes treaty withholding relief and stores the result | `{ orgSlug, taxEntityId, counterpartyJurisdiction, paymentType, grossAmount, domesticRate, treatyRate, reliefMethod, treatyArticle?, notes?, metadata? }` | `{ calculation, result }` | 30/min per user | n/a |
| POST | `/functions/v1/tax-mt-nid` (`calculator=TREATY_WHT`, `action=UPSERT_CASE`) | Supabase JWT | Creates or updates MAP/APA dispute cases | `{ orgSlug, taxEntityId, caseType, counterpartyJurisdiction, counterpartyAuthority?, caseReference?, status?, openedOn?, expectedResolution?, reliefAmount?, issueSummary?, notes?, metadata?, caseId? }` | `{ case }` | 20/min per user | n/a |
| POST | `/functions/v1/tax-mt-nid` (`calculator=TREATY_WHT`, `action=ADD_EVENT`) | Supabase JWT | Logs timeline events against dispute cases | `{ orgSlug, caseId, eventType, eventDate?, description?, metadata? }` | `{ event }` | 40/min per user | n/a |
| GET | `/functions/v1/tax-mt-nid` (`calculator=TREATY_WHT`) | Supabase JWT | Lists treaty computations (default), cases (`resource=CASES`), or events (`resource=EVENTS`) | Query: `orgSlug`, `resource?`, `taxEntityId?`, `status?`, `disputeId?` | `{ data[] }` | 60/min per user | auto |
| POST | `/functions/v1/tax-mt-nid` (`calculator=US_OVERLAY`) | Supabase JWT | Computes US overlay (GILTI/163(j)/CAMT/§4501) and stores results | `{ orgSlug, taxEntityId, period, overlayType, ...inputs, notes?, metadata? }` | `{ calculation, result, adjustmentAmount }` | 20/min per user | n/a |
| GET | `/functions/v1/tax-mt-nid` (`calculator=US_OVERLAY`) | Supabase JWT | Lists US overlay computations filtered by overlay type | Query: `orgSlug`, `taxEntityId?`, `overlayType?` | `{ data[] }` | 60/min per user | auto |
| POST | `/functions/v1/telemetry-sync` | Supabase JWT | Aggregates telemetry coverage and SLA metrics | `{ orgSlug, periodStart?, periodEnd? }` | `{ coverage[], sla }` | 10/min per user | n/a |
| POST | `/functions/v1/archive-sync` | Supabase JWT | Regenerates engagement archive manifest & checksum | `{ orgSlug, engagementId }` | `{ manifest, sha256 }` | 10/min per user | n/a |
| POST | `/functions/v1/error-notify` | Supabase JWT | Logs telemetry error event and optionally posts to webhook | `{ orgSlug, module, error, context? }` | `{ success: true }` | 30/min per user | n/a |
| GET | `/functions/v1/audit-controls/list` | Supabase JWT | Fetch controls, walkthroughs, tests, deficiencies, ITGC groups | Query: `orgSlug`, `engagementId` | `{ controls[], itgcGroups[], deficiencies[] }` | 60/min per user | auto |
| POST | `/functions/v1/audit-controls/control/upsert` | Supabase JWT | Create or update a control matrix entry | `{ orgSlug, engagementId, cycle, objective, ... }` | `{ id }` | 30/min per user | n/a |
| POST | `/functions/v1/audit-controls/control/walkthrough/log` | Supabase JWT | Record design/implementation walkthrough outcome | `{ orgSlug, controlId, date, result, notes? }` | `{ success }` | 40/min per user | n/a |
| POST | `/functions/v1/audit-controls/control/test/run` | Supabase JWT | Log attributes testing, auto-raise deficiency on exceptions | `{ orgSlug, controlId, attributes?, samplePlanRef?, result, severity?, recommendation? }` | `{ success }` | 40/min per user | n/a |
| POST | `/functions/v1/audit-controls/deficiency/create` | Supabase JWT | Manually create deficiency linked to controls | `{ orgSlug, engagementId, controlId?, severity, recommendation, status? }` | `{ success }` | 30/min per user | n/a |
| POST | `/functions/v1/audit-controls/itgc/upsert` | Supabase JWT | Register ITGC grouping (access/change/operations) | `{ orgSlug, engagementId?, type, scope?, notes? }` | `{ success }` | 20/min per user | n/a |
| POST | `/functions/v1/audit-tcwg/create` | Supabase JWT | Initialise TCWG pack with data from report, misstatements, GC | `{ orgSlug, engagementId }` | `{ pack }` | 20/min per user | n/a |
| POST | `/functions/v1/audit-tcwg/update` | Supabase JWT | Update TCWG narrative fields and deficiencies | `{ orgSlug, engagementId, packId, ... }` | `{ pack }` | 60/min per user | n/a |
| POST | `/functions/v1/audit-tcwg/render` | Supabase JWT | Render TCWG pack PDF to storage | `{ orgSlug, engagementId, packId }` | `{ pack, documentId }` | 20/min per user | n/a |
| POST | `/functions/v1/audit-tcwg/build-zip` | Supabase JWT | Build ZIP containing PDF and annex JSON schedules | `{ orgSlug, engagementId, packId }` | `{ pack, documentId, sha256 }` | 20/min per user | n/a |
| POST | `/functions/v1/audit-tcwg/submit` | Supabase JWT | Submit pack for approval (Manager/Partner/EQR) | `{ orgSlug, engagementId, packId }` | `{ pack }` | 10/min per user | n/a |
| POST | `/functions/v1/audit-tcwg/approval/decide` | Supabase JWT | Record TCWG approval decision | `{ orgSlug, engagementId, approvalId, decision, note? }` | `{ approvals[] }` | 30/min per user | n/a |
| POST | `/functions/v1/audit-tcwg/send` | Supabase JWT | Share pack with client portal, update archive manifest | `{ orgSlug, engagementId, packId }` | `{ pack, shareUrl, sha256 }` | 10/min per user | n/a |
| GET | `/functions/v1/audit-tcwg/get` | Supabase JWT | Fetch TCWG pack, approvals, report release status | Query: `orgSlug`, `engagementId` | `{ pack, approvals[], reportReleased }` | 60/min per user | auto |
