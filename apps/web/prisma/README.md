# Prisma & Supabase Integration

This directory contains the Prisma data model and migration history for the `apps/web` Next.js service.

- `schema.prisma` mirrors the Supabase Postgres schema.
- `migrations/` stores SQL generated by `prisma migrate diff` / `prisma migrate dev`.
- `DATABASE_URL` and optional `DIRECT_URL` environment variables are read at build and deploy time. `DIRECT_URL` should target a pooled connection for migrations (Supabase transactional pooler).

## Authoring changes

1. Update `schema.prisma` to describe the desired change.
2. Run `npm run prisma:migrate:dev -- --name <feature>` from `apps/web` against a local or Supabase branch database.
3. Commit the generated migration folder and the updated schema.
4. Open a pull request. CI will run `prisma validate` and `prisma migrate diff` to surface the SQL.

## Applying to Supabase

- Staging (Preview): automatically via GitHub Actions on merges to `main` once `DATABASE_URL`/`DIRECT_URL` secrets are configured.
- Production: trigger the `Supabase Prisma Deploy` workflow manually (`workflow_dispatch`) selecting `production`. The workflow runs `prisma migrate deploy` using the production secrets.

After each apply, run through the post-deployment checklist documented in `docs/deployment/prisma-vercel-supabase.md` (introspect, generate client, seed, smoke-test).
